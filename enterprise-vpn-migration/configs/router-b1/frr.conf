!
! FRR Configuration - Router-B1 (Site B Edge Router)
! VPN Endpoint, BGP Peering, OSPF Core
!
! Role: Site B edge router with VPN tunnel to Site A
! Interfaces:
!   - eth1: 10.0.34.1/30 (OSPF to router-b2)
!   - eth2: 198.51.100.10/30 (WAN - OLD IP, will migrate to 192.0.2.20)
!   - eth3: 100.64.0.20/24 (BGP peering to internet-core)
!   - gre0: 172.16.0.2/30 (VPN tunnel to Site A)
!
frr version 9.1.0
frr defaults traditional
hostname router-b1
log syslog informational
service integrated-vtysh-config
!
! Interface Configuration
!
interface eth1
 description OSPF link to router-b2 (core)
 ip address 10.0.34.1/30
 ip ospf area 0.0.0.0
 ip ospf network point-to-point
 ip ospf hello-interval 5
 ip ospf dead-interval 15
exit
!
interface eth2
 description WAN link to ISP-B (OLD: 198.51.100.10, NEW: 192.0.2.20)
 ! IP configured via exec commands in topology
 ! This allows migration without editing this file
exit
!
interface eth3
 description BGP peering to internet-core
 ! IP configured via exec commands: 100.64.0.20/24
exit
!
interface gre0
 description GRE tunnel to Site A (router-a1)
 ! GRE tunnel created via exec commands
 ! Tunnel IPs: 172.16.0.2 (local) <-> 172.16.0.1 (remote)
 ip ospf area 0.0.0.0
 ip ospf network point-to-point
 ip ospf cost 100
 ip ospf hello-interval 5
 ip ospf dead-interval 15
exit
!
! Static Routes
!
ip route 0.0.0.0/0 198.51.100.9
! Default route via ISP-B gateway
! Note: Will need to update to 192.0.2.19 during migration
!
! OSPF Configuration
!
router ospf
 ospf router-id 10.0.34.1
 log-adjacency-changes
 passive-interface eth2
 passive-interface eth3
 network 10.0.34.0/30 area 0.0.0.0
 network 172.16.0.0/30 area 0.0.0.0
 redistribute connected route-map CONN-TO-OSPF
exit
!
! Route-map to selectively redistribute connected routes
!
route-map CONN-TO-OSPF permit 10
 match interface eth1
exit
!
route-map CONN-TO-OSPF permit 20
 match interface gre0
exit
!
route-map CONN-TO-OSPF deny 999
exit
!
! BGP Configuration
!
router bgp 64513
 bgp router-id 100.64.0.20
 bgp log-neighbor-changes
 no bgp default ipv4-unicast
 !
 neighbor 100.64.0.101 remote-as 65000
 neighbor 100.64.0.101 description eBGP to internet-core
 neighbor 100.64.0.101 ebgp-multihop 2
 neighbor 100.64.0.101 update-source eth3
 !
 address-family ipv4 unicast
  network 10.2.0.0/16
  neighbor 100.64.0.101 activate
  neighbor 100.64.0.101 soft-reconfiguration inbound
  neighbor 100.64.0.101 route-map SITE-B-OUT out
 exit-address-family
exit
!
! BGP route-map to advertise Site B networks
!
ip prefix-list SITE-B-NETWORKS seq 10 permit 10.2.0.0/16 le 32
exit
!
route-map SITE-B-OUT permit 10
 match ip address prefix-list SITE-B-NETWORKS
exit
!
route-map SITE-B-OUT deny 999
exit
!
! Access Control
!
line vty
 exec-timeout 0 0
exit
!
end
